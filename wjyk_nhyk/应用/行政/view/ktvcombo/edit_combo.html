<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>分类</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="__PUBLIC__/static/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__PUBLIC__/static/layuiadmin/style/admin.css" media="all">
    <link rel="stylesheet" href="__PUBLIC__/static/layuiadmin/layui/layui_exts/formSelects/formSelects-v4.css" media="all">
    <style>
        form{
            padding-right:15px ;
        }
    </style>
</head>
<body>
<form class="layui-form" style="margin-top:21px;">
  <input type="hidden" name="id" value="{$srdb['id']}">
  


  <div class="layui-form-item">
    <label class="layui-form-label">名称</label>
    <div class="layui-input-block">
      <input type="text" name="name" required lay-verify="required" placeholder="请输入分类名称" autocomplete="off" class="layui-input" value="{$srdb['name']}">
    </div>
  </div>
  
    <div class="layui-form-item">
	    <label class="layui-form-label">包厢类型</label>
	    <div class="layui-input-block">
	      	<select lay-filter="typeSelect" name="cid"  >	
              	 {if empty($cate)}	
              	      <option value="">暂无</option>	
              	 {else}							        						    	
	              	 {foreach  $cate as $v}						                  
	              		 <option value="{$v.id}"  {eq name="$rdb.cid" value="$v.id"} selected="" {/eq}>{$v.c_name}</option>							        
	              	 {/foreach}							    
              	 {/if}				           
              	  </select>  
	    </div>
	  </div>
	  
	
  
  
  <div class="layui-form-item">
    <label class="layui-form-label">选择时间范围</label>

    <div class="layui-upload col-sm-9">  
      <div class="layui-input-block">
           <input type="text" class="layui-input" name="effective" id="test9"  value="{$srdb['effective']}" />
      </div>
    </div>
  </div>
  
  
  <!-- <div class="layui-form-item">
	    <label class="layui-form-label">套餐</label>
	    <div class="layui-input-block">
	      	<select lay-filter="typeSelect" name="tid"  >	
              	 {if empty($meal)}	
              	      <option value="">暂无</option>	
              	 {else}		
              	     <option value="">不选择套餐</option>						        						    	
	              	 {foreach  $meal as $v}						                  
	              		 <option value="{$v.id}"  {eq name="$srdb.tid" value="$v.id"} selected="" {/eq}>{$v.meal_name} 价格: {$v.meal_money}</option>							        
	              	 {/foreach}							    
              	 {/if}				           
              	  </select>  
	    </div>
	  </div> -->
  
  
  <div class="layui-form-item">
        <label class="layui-form-label">选择套餐</label>
        
        <div class="layui-input-block">
            <select name="tags" id="tags" lay-verify="required" xm-select="tags" xm-select-skin="normal">
               
     		</select>
        </div>
  </div>
	  
  <div class="layui-form-item">
    <label class="layui-form-label">开场时间选择间隔</label>
    <div class="layui-input-block">
      <input type="radio" name="interval_time" value="1" title="小时" {if $srdb['interval_time'] == '1' || $srdb['interval_time'] == ''}checked{/if}>
      <input type="radio" name="interval_time" value="2" title="半小时" {if $srdb['interval_time'] == '2'}checked{/if}>
    </div>
  </div>

  
  
     
  <div class="layui-form-item">
        <label class="layui-form-label">价格</label>
        <div class="layui-input-block">
            <input type="text" name="price" required lay-verify="required" placeholder="100" autocomplete="off" class="layui-input" value="{$srdb['price']}">
        </div>
    </div>
     <div class="layui-form-item">
        <label class="layui-form-label">可使用小时</label>
        <div class="layui-input-block">
            <input type="text" name="hour" required lay-verify="required" autocomplete="off" class="layui-input" value="{$srdb['hour']}">
        </div>
    </div>

  <div class="layui-form-item">
    <label class="layui-form-label">排序</label>
    <div class="layui-input-block">
      <input type="number" name="sort"  placeholder="请输入排序值 ，数值越高，越在前显示" autocomplete="off" class="layui-input" value="{$srdb['sort']}">
    </div>
  </div>
   
  <div class="layui-form-item">
    <label class="layui-form-label">是否开启</label>
    <div class="layui-input-block">
      <input type="radio" name="is_show" value="2" title="显示" {if $srdb['is_show'] == '2' || $srdb['is_show'] == ''}checked{/if}>
      <input type="radio" name="is_show" value="1" title="隐藏" {if $srdb['is_show'] == '1'}checked{/if}>
    </div>
  </div>
  <div class="layui-form-item">
    <div class="layui-input-block">
      <button class="layui-btn" lay-submit lay-filter="demo1">立即提交</button>
    </div>
  </div>

   
 <script type="text/html" id="test-table-operate-barDemo">       
   		 <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
     </script>
  
  <!-- 更多表单结构排版请移步文档左侧【页面元素-表单】一项阅览 -->
</form>
<script src="__PUBLIC__/static/layuiadmin/layui/layui.js"></script>
<script>
    layui.config({
        base: '__PUBLIC__/static/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
        , formSelects: '../layuiadmin/layui/layui_exts/formSelects/formSelects-v4'
    }).use('index');

</script>
<script>
    layui.use(['jquery','form', 'laydate','upload','formSelects','table'], function(){
    	var $ = layui.$
    		,form = layui.form
    		,table = layui.table
            ,layer = layui.layer
            ,laydate = layui.laydate
            , formSelects = layui.formSelects
            , upload = layui.upload;
        
    	
    	
    	formSelects.config('tags', {
    	    type: 'get',                //请求方式: post, get, put, delete...
    	    header: {},                 //自定义请求头
    	    data: {id:"<?= $srdb['id']; ?>"},                   //自定义除搜索内容外的其他数据
    	    searchUrl: "{:siteUrl('admin/ktvMeal/get_all_meal','','web')}&id=<?= $srdb['id']; ?>",              //搜索地址, 默认使用xm-select-search的值, 此参数优先级高
    	    searchName: 'name',      //自定义搜索内容的key值
    	    searchVal: '',              //自定义搜索内容, 搜素一次后失效, 优先级高于搜索框中的值
    	    keyName: 'meal_name',            //自定义返回数据中name的key, 默认 name
    	    keyVal: 'id',            //自定义返回数据中value的key, 默认 value
    	    keySel: 'selected',         //自定义返回数据中selected的key, 默认 selected
    	    keyDis: 'disabled',         //自定义返回数据中disabled的key, 默认 disabled
    	    keyChildren: 'children',    //联动多选自定义children
    	    delay: 500,                 //搜索延迟时间, 默认停止输入500ms后开始搜索
    	    direction: 'auto',          //多选下拉方向, auto|up|down
    	    response: {
    	        statusCode: 0,          //成功状态码
    	        statusName: 'code',     //code key
    	        msgName: 'msg',         //msg key
    	        dataName: 'data'        //data key
    	    },
    	    success: function(id, url, searchVal, result){      //使用远程方式的success回调
    	    	if(result && result.selected.length>0){
    	    		formSelects.value('tags', result.selected);
    	    	}
    	    	debugger;
    	      
    	    },
    	    error: function(id, url, searchVal, err){           //使用远程方式的error回调
    	        //同上
    	       
    	    },
    	    beforeSuccess: function(id, url, searchVal, result){        //success之前的回调, 干嘛呢? 处理数据的, 如果后台不想修改数据, 你也不想修改源码, 那就用这种方式处理下数据结构吧
    	
    	        return result;  //必须return一个结果, 这个结果要符合对应的数据结构
    	    },
    	    beforeSearch: function(id, url, searchVal){         //搜索前调用此方法, return true将触发搜索, 否则不触发
    	        if(!searchVal){//如果搜索内容为空,就不触发搜索
    	            return false;
    	        }
    	        return true;
    	    },
    	    clearInput: false,          //当有搜索内容时, 点击选项是否清空搜索内容, 默认不清空
    	}, true);
    	
    	
        //监听工具条
        table.on('tool(test-table-operate)', function(obj){
            var data = obj.data;
            if(obj.event === 'del'){
            	var data_index = $(this).parents('tr').data('index');
                layer.confirm('确定删除该数据吗？', function(index){
                	obj.del();
                    layer.close(index);
                    var tabledata = table.cache["test-table-operate"];
                	tabledata.splice(data_index, 1);
                });
            } 
        });
        $("#mei_upload").click(function(){ 
        	 var tabledata = table.cache["test-table-operate"]; //获取现有数据
             tabledata.push({
           
             "name":""
             ,"price": "0"
             })
             //添加数据,  字段名对应值.  不要初始值的话 留空即可.

            
              table.reload("test-table-operate", {
             	data: tabledata,
             }); 
        	
        });
    	
    	
    	upload.render({
            elem: '#test1'
            ,url: "{:siteUrl('admin/index/upload','','web')}" //改成您自己的上传接口
            ,done: function(res){
                //如果上传失败
                if(res.code < 0){
                    return layer.msg('上传失败');
                }else{
                    $('#demo1').attr('src', res.msg); //图片链接（base64）
                    $('#ico').val(res.msg);
                }
            }
        });
    	
    	laydate.render({
    		  elem: '#test9'
    		  ,type: 'time'
    		  ,range: true
    	});
    	
      //监听提交
        form.on('submit(demo1)', function(data){
            var admin = layui.admin;
            var meals = formSelects.value('tags', 'val');  
            data.field.meals = meals;
            
			/* var tabledata = table.cache["test-table-operate"];
			
            data.field['com_meal'] = tabledata; */
            
            admin.req({
                url:"{:siteUrl('admin/ktvCombo/edit_combo','','web')}",
                data:data.field,
                type:"POST",
                done:res=>{
                	if(res.code == 0 ){
               			layer.msg(res.msg,{icon: 1,time:3000},function(){
               				window.parent.location.reload()//刷新父页面
               				var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
               	      	    parent.layer.close(index); //再执行关闭  
                   		});
                		
                	}else{
                		layer.msg(res.msg,{icon: 2,time:3000},function(){
                			window.parent.location.reload()//刷新父页面
                			var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
               	      	    parent.layer.close(index); //再执行关闭  
                		});
                	}
                }
            })
            return false
  
        });
        $("#return").click(function(){
        	window.parent.location.reload()//刷新父页面
        	var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
      	    parent.layer.close(index); //再执行关闭  
        });

        //表单取值
        layui.$('#LAY-component-form-getval').on('click', function(){
            var data = form.val('example');
            alert(JSON.stringify(data));
        });

    });
</script>
</body>
</html>